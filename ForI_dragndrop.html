<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finished or Still Important</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,system-ui,sans-serif;color:#333;}
html,body{height:100%;width:100%;}
body{background:#f8fafc;display:flex;flex-direction:column;align-items:center;padding:10px;gap:10px;touch-action:none;}

h2,p{text-align:center;}

.wrapper{width:100%;max-width:1000px;display:flex;flex-direction:column;gap:10px;flex-grow:1;}

.columns{
  display:flex;
  gap:10px;
  flex-grow:1;
}

.column{
  flex:1;
  background:#eef6f9;
  border:2px dashed #94a3b8;
  border-radius:8px;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  min-height:200px;
}

.column h3{
  text-align:center;
  font-size:min(1.3vw, 20px);
}

.dropzone{
  flex-grow:1;
  display:flex;
  flex-direction:column;
  gap:8px;
  min-height:100px;
}

#pool{
  background:#f1f5f9;
  border:2px solid #cbd5e1;
  border-radius:8px;
  padding:10px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  min-height:80px;
}

.sentence{
  background:#e8f4fd;
  border:2px solid #538e9b;
  border-radius:6px;
  padding:8px 12px;
  font-size:min(1.2vw, 18px);
  cursor:grab;
  user-select:none;
  touch-action:none;
  position:relative;
  transition:transform 0.2s;
}

.sentence.dragging{
  opacity:0.7;
  transform:scale(1.05);
  z-index:1000;
  position:fixed !important;
}

.correct{border-color:#4fa46b !important;background:#e7f6ec;}
.incorrect{border-color:#c05b6d !important;background:#fdecee;}

button{
  padding:8px 16px;
  font-size:min(1.2vw, 18px);
  border:none;
  border-radius:6px;
  background:#538e9b;
  color:white;
  cursor:pointer;
  align-self:center;
}

button:hover{background:#3b6b7c;}

#message{
  font-size:min(1.2vw, 18px);
  font-weight:600;
  text-align:center;
  color:#538e9b;
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .columns {
    flex-direction: column;
  }
  
  .column {
    min-height:150px;
  }
  
  .sentence {
    font-size:16px;
  }
  
  .column h3 {
    font-size:18px;
  }
}
</style>
</head>

<body>

<h2>Finished or Still Important?</h2>
<p>
Drag each sentence to the correct column.  
If it's incorrect, move it to change your answer.  
Click a sentence to return it to the pool.
</p>

<div class="wrapper">

  <div class="columns">
    <div class="column" data-type="past">
      <h3>‚úÖ Finished</h3>
      <div class="dropzone"></div>
    </div>

    <div class="column" data-type="present">
      <h3>üîÅ Still important now</h3>
      <div class="dropzone"></div>
    </div>
  </div>

  <div id="pool"></div>

  <button id="checkBtn">Check Answers</button>
  <div id="message"></div>

</div>

<script>
const sentencesData = [
  { text: "I argued with my neighbors.", type: "past" },
  { text: "We moved out of the apartment in April.", type: "past" },
  { text: "The landlord ignored my messages for weeks.", type: "past" },
  { text: "I looked at five apartments before I chose this one.", type: "past" },
  { text: "The police came because of a noise complaint.", type: "past" },
  { text: "My neighbors played loud music every night.", type: "past" },

  { text: "I have moved to a quieter neighborhood.", type: "present" },
  { text: "I've had problems with neighbors before.", type: "present" },
  { text: "I have learned to ask questions before renting.", type: "present" },
  { text: "I've been happier since I changed apartments.", type: "present" },
  { text: "I have talked to the landlord about the situation.", type: "present" },
  { text: "I have never lived alone before.", type: "present" }
];

let draggedItem = null;
let isTouchDragging = false;
let touchStartX = 0;
let touchStartY = 0;
let touchOffsetX = 0;
let touchOffsetY = 0;
let activeDropzone = null;

const pool = document.getElementById("pool");
const columns = document.querySelectorAll(".column .dropzone");
const message = document.getElementById("message");

function clearFeedback(el){
  el.classList.remove("correct","incorrect");
}

function addDragEvents(element) {
  // Mouse events
  element.addEventListener("dragstart", handleDragStart);
  element.addEventListener("dragend", handleDragEnd);
  
  // Touch events
  element.addEventListener("touchstart", handleTouchStart, { passive: false });
  element.addEventListener("touchmove", handleTouchMove, { passive: false });
  element.addEventListener("touchend", handleTouchEnd);
  
  // Click event
  element.addEventListener("click", handleClick);
  
  // Prevent context menu on long press
  element.addEventListener("contextmenu", e => e.preventDefault());
}

function init(){
  pool.innerHTML = "";
  message.textContent = "";

  shuffle(sentencesData).forEach(item=>{
    const div = document.createElement("div");
    div.className = "sentence";
    div.textContent = item.text;
    div.dataset.type = item.type;
    div.draggable = true;
    
    addDragEvents(div);
    pool.appendChild(div);
  });

  // Add drop events to all dropzones (including pool)
  const allDropzones = document.querySelectorAll(".dropzone, #pool");
  
  allDropzones.forEach(zone=>{
    // Mouse events
    zone.addEventListener("dragover", handleDragOver);
    zone.addEventListener("drop", handleDrop);
    
    // Touch events
    zone.addEventListener("touchmove", handleZoneTouchMove, { passive: false });
    zone.addEventListener("touchend", handleZoneTouchEnd);
  });
}

// Mouse event handlers
function handleDragStart(e) {
  draggedItem = e.target;
  draggedItem.classList.add("dragging");
  clearFeedback(draggedItem);
  e.dataTransfer.setData('text/plain', ''); // Required for Firefox
}

function handleDragEnd(e) {
  if (draggedItem) {
    draggedItem.classList.remove("dragging");
    draggedItem = null;
  }
}

function handleDragOver(e) {
  e.preventDefault();
}

function handleDrop(e) {
  e.preventDefault();
  if (draggedItem) {
    clearFeedback(draggedItem);
    this.appendChild(draggedItem);
    draggedItem.classList.remove("dragging");
    draggedItem = null;
  }
}

// Touch event handlers
function handleTouchStart(e) {
  e.preventDefault();
  const touch = e.touches[0];
  draggedItem = e.target;
  isTouchDragging = true;
  
  // Store initial positions
  touchStartX = touch.clientX;
  touchStartY = touch.clientY;
  
  const rect = draggedItem.getBoundingClientRect();
  touchOffsetX = touch.clientX - rect.left;
  touchOffsetY = touch.clientY - rect.top;
  
  // Setup for dragging
  draggedItem.classList.add("dragging");
  clearFeedback(draggedItem);
  
  // Store original parent
  draggedItem.dataset.originalParent = draggedItem.parentElement.id || 'pool';
  
  // Position element for dragging
  draggedItem.style.left = rect.left + 'px';
  draggedItem.style.top = rect.top + 'px';
  draggedItem.style.width = rect.width + 'px';
}

function handleTouchMove(e) {
  if (!isTouchDragging || !draggedItem) return;
  
  e.preventDefault();
  const touch = e.touches[0];
  
  // Move the element
  draggedItem.style.left = (touch.clientX - touchOffsetX) + 'px';
  draggedItem.style.top = (touch.clientY - touchOffsetY) + 'px';
  
  // Find dropzone under touch
  const dropzone = findDropzoneAtPoint(touch.clientX, touch.clientY);
  
  // Visual feedback for active dropzone
  if (activeDropzone !== dropzone) {
    // Reset previous active dropzone
    if (activeDropzone) {
      activeDropzone.style.borderStyle = 'dashed';
      activeDropzone.style.backgroundColor = '';
    }
    
    // Highlight new active dropzone
    activeDropzone = dropzone;
    if (activeDropzone && activeDropzone !== draggedItem.parentElement) {
      activeDropzone.style.borderStyle = 'solid';
      activeDropzone.style.backgroundColor = 'rgba(83, 142, 155, 0.1)';
    }
  }
}

function handleTouchEnd(e) {
  if (!isTouchDragging || !draggedItem) return;
  
  e.preventDefault();
  isTouchDragging = false;
  
  // Reset active dropzone styling
  if (activeDropzone) {
    activeDropzone.style.borderStyle = 'dashed';
    activeDropzone.style.backgroundColor = '';
  }
  
  // Find where to drop
  const touch = e.changedTouches[0];
  const dropzone = findDropzoneAtPoint(touch.clientX, touch.clientY);
  
  // Move to new location if valid
  if (dropzone && dropzone !== draggedItem.parentElement) {
    clearFeedback(draggedItem);
    dropzone.appendChild(draggedItem);
  }
  
  // Reset element styling
  draggedItem.classList.remove("dragging");
  draggedItem.style.left = '';
  draggedItem.style.top = '';
  draggedItem.style.width = '';
  draggedItem.style.position = '';
  draggedItem.style.zIndex = '';
  
  draggedItem = null;
  activeDropzone = null;
}

function handleZoneTouchMove(e) {
  // Allow touch to pass through to handleTouchMove
  if (isTouchDragging) {
    e.preventDefault();
  }
}

function handleZoneTouchEnd(e) {
  // No special handling needed here
}

function handleClick(e) {
  // Only process click if not currently dragging
  if (!isTouchDragging && e.target.classList.contains('sentence')) {
    clearFeedback(e.target);
    pool.appendChild(e.target);
  }
}

function findDropzoneAtPoint(x, y) {
  // Check all dropzones (including pool)
  const dropzones = document.querySelectorAll('.dropzone, #pool');
  
  for (const zone of dropzones) {
    const rect = zone.getBoundingClientRect();
    if (x >= rect.left && x <= rect.right && 
        y >= rect.top && y <= rect.bottom) {
      return zone;
    }
  }
  
  return null;
}

document.getElementById("checkBtn").addEventListener("click", ()=>{
  let allPlaced = true;
  let correct = 0;

  document.querySelectorAll(".sentence").forEach(s=>{
    clearFeedback(s);

    if(s.parentElement.id === "pool"){
      allPlaced = false;
      s.classList.add("incorrect");
      return;
    }

    const columnType = s.closest(".column").dataset.type;
    if(s.dataset.type === columnType){
      s.classList.add("correct");
      correct++;
    } else {
      s.classList.add("incorrect");
    }
  });

  if(!allPlaced){
    message.textContent = "Put all sentences into a column.";
  } else if(correct === sentencesData.length){
    message.textContent = "üéâ All answers correct!";
  } else {
    message.textContent = "Some answers are incorrect. Move the red ones to change your answers.";
  }
});

function shuffle(arr){
  return [...arr].sort(()=>Math.random()-0.5);
}

init();
</script>

</body>
</html>
